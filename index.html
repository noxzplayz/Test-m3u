<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Multi-Channel M3U8 Player</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 20px;
      text-align: center;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      width: 80%;
      max-width: 500px;
      margin: 10px auto;
    }
    video {
      margin-top: 20px;
      width: 100%;
      max-width: 800px;
      border: 1px solid #ccc;
    }
    ul {
      margin-top: 30px;
      padding: 0;
      list-style: none;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    li {
      background: white;
      padding: 10px;
      margin-bottom: 5px;
      border: 1px solid #ddd;
      cursor: pointer;
      transition: background 0.2s;
    }
    li:hover {
      background: #e6f7ff;
    }
  </style>
</head>
<body>

  <h1>Multi-Channel M3U8 Playlist Player</h1>

  <input type="text" id="m3uUrl" value="https://allinonereborn.site/tplay333.m3u" placeholder="Enter M3U URL">
  <button onclick="loadM3UPlaylist()">Load Channels</button>

  <video id="videoPlayer" controls autoplay></video>

  <ul id="channelList"></ul>

  <script>
    async function loadM3UPlaylist() {
      const url = document.getElementById('m3uUrl').value;
      const list = document.getElementById('channelList');
      const video = document.getElementById('videoPlayer');
      list.innerHTML = "";

      try {
        const res = await fetch(url);
        const text = await res.text();
        const lines = text.split('\n');

        let channels = [];
        let currentTitle = "";

        for (let i = 0; i < lines.length; i++) {
          const line = lines[i].trim();
          if (line.startsWith('#EXTINF')) {
            currentTitle = line.split(',').pop().trim();
          } else if (line && !line.startsWith('#')) {
            channels.push({ title: currentTitle || 'Unnamed Channel', url: line });
            currentTitle = "";
          }
        }

        if (channels.length === 0) {
          alert("No playable channels found.");
          return;
        }

        channels.forEach((channel, index) => {
          const li = document.createElement('li');
          li.textContent = `${index + 1}. ${channel.title}`;
          li.onclick = () => playChannel(channel.url);
          list.appendChild(li);
        });

        // Autoplay first channel
        playChannel(channels[0].url);

      } catch (err) {
        alert("Failed to load or parse playlist.");
        console.error(err);
      }
    }

    function playChannel(streamUrl) {
      const video = document.getElementById('videoPlayer');
      if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(streamUrl);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        // Safari fallback
        video.src = streamUrl;
        video.play();
      } else {
        alert("Your browser does not support HLS playback.");
      }
    }
  </script>

</body>
</html>
